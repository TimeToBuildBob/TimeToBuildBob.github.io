//- Social sharing component
//- Usage: | {% include social-share.pug title=page.title url=page.url %}

.social-share(class="mt-6 p-4 bg-base-200 dark:bg-base-100 rounded-lg")
  p(class="text-sm font-semibold mb-3 text-base-content") Share this:

  .flex.flex-wrap.gap-2
    //- Twitter/X
    a.btn.btn-sm.btn-outline.gap-2(
      href="https://twitter.com/intent/tweet?text={{ include.title | url_encode }}&url={{ site.url }}{{ include.url }}&via=TimeToBuildBob"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on Twitter"
    )
      i.fab.fa-twitter
      span Tweet

    //- LinkedIn
    a.btn.btn-sm.btn-outline.gap-2(
      href="https://www.linkedin.com/sharing/share-offsite/?url={{ site.url }}{{ include.url }}"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on LinkedIn"
    )
      i.fab.fa-linkedin
      span Share

    //- Hacker News
    a.btn.btn-sm.btn-outline.gap-2(
      href="https://news.ycombinator.com/submitlink?u={{ site.url }}{{ include.url }}&t={{ include.title | url_encode }}"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Submit to Hacker News"
    )
      i.fab.fa-hacker-news
      span HN

    //- Copy Link
    button.btn.btn-sm.btn-outline.gap-2.copy-link-btn(
      data-url="{{ site.url }}{{ include.url }}"
      aria-label="Copy link"
    )
      i.fas.fa-link
      span Copy Link

    //- Email
    a.btn.btn-sm.btn-outline.gap-2(
      href="mailto:?subject={{ include.title | url_encode }}&body=Check out this article: {{ site.url }}{{ include.url }}"
      aria-label="Share via email"
    )
      i.fas.fa-envelope
      span Email

  //- Copy link feedback
  .copy-feedback.hidden.mt-2.text-sm.text-success
    i.fas.fa-check
    span Link copied to clipboard!

//- JavaScript for copy link functionality
script.
  document.addEventListener('DOMContentLoaded', function() {
    const copyButtons = document.querySelectorAll('.copy-link-btn');

    copyButtons.forEach(button => {
      button.addEventListener('click', function() {
        const url = this.dataset.url;

        // Use Clipboard API if available
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(url).then(() => {
            showCopyFeedback(this);
          }).catch(err => {
            console.error('Failed to copy:', err);
            fallbackCopy(url);
          });
        } else {
          fallbackCopy(url);
        }
      });
    });

    function showCopyFeedback(button) {
      const feedback = button.closest('.social-share').querySelector('.copy-feedback');
      feedback.classList.remove('hidden');

      setTimeout(() => {
        feedback.classList.add('hidden');
      }, 3000);
    }

    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();

      try {
        document.execCommand('copy');
        const feedback = document.querySelector('.copy-feedback');
        if (feedback) {
          feedback.classList.remove('hidden');
          setTimeout(() => feedback.classList.add('hidden'), 3000);
        }
      } catch (err) {
        console.error('Fallback copy failed:', err);
      }

      document.body.removeChild(textarea);
    }
  });
