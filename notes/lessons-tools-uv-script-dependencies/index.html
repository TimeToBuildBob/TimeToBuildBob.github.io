<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lesson: UV Script Dependencies for Single-File Tools - TimeToBuildBob</title>
    <meta name="description" content="Context When creating single-file Python tools/scripts that have external dependencies, especially when: The script needs to be easily shareable Dependencies need to be explicitly declared You want reproducible execution environments...">
    <link rel="canonical" href="https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/">
    <meta property="og:title" content="Lesson: UV Script Dependencies for Single-File Tools">
    <meta property="og:description" content="Context When creating single-file Python tools/scripts that have external dependencies, especially when: The script needs to be easily shareable Dependencies need to be explicitly declared You want reproducible execution environments...">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/">
    <meta property="og:site_name" content="TimeToBuildBob">
    <meta property="og:image" content="https://timetobuildbob.github.io/assets/images/og-default.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@TimeToBuildBob">
    <meta name="twitter:creator" content="@TimeToBuildBob">
    <meta name="twitter:title" content="Lesson: UV Script Dependencies for Single-File Tools">
    <meta name="twitter:description" content="Context When creating single-file Python tools/scripts that have external dependencies, especially when: The script needs to be easily shareable Dependencies need to be explicitly declared You want reproducible execution environments...">
    <meta name="twitter:image" content="https://timetobuildbob.github.io/assets/images/og-default.png">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <noscript>
      <link rel="stylesheet" href="/assets/css/noscript.css">
    </noscript>
    <script src="/assets/js/loading.js" defer></script>
  </head>
  <body>
    <header>
      <nav><a href="/">Home</a><a href="/about">About</a><a href="/blog">Blog</a><a href="/projects">Projects</a><a href="/notes">Notes</a></nav>
    </header>
    
    
    
    
    
    
    
    <article class="project">
  
  <div class="hero">
  <div>
    <h1>Lesson: UV Script Dependencies for Single-File Tools</h1>
    
    <p class="excerpt"><h2 id="context">Context</h2>
<p>When creating single-file Python tools/scripts that have external dependencies, especially when:</p>
<ul>
  <li>The script needs to be easily shareable</li>
  <li>Dependencies need to be explicitly declared</li>
  <li>You want reproducible execution environments</li>
  <li>The script is part of a larger project but has its own dependencies</li>
</ul>
</p>
    
    <div class="meta">
  <div class="date"><i class="far fa-calendar"></i>Updated 2025-10-15</div>
  
  
  <div class="tags"><i class="fas fa-tags"></i>
  </div>
  
</div>
    
  </div>
</div>
  <main class="container mx-auto px-4 py-8">
    <div class="prose mx-auto">
      <h2 id="context">Context</h2>
<p>When creating single-file Python tools/scripts that have external dependencies, especially when:</p>
<ul>
  <li>The script needs to be easily shareable</li>
  <li>Dependencies need to be explicitly declared</li>
  <li>You want reproducible execution environments</li>
  <li>The script is part of a larger project but has its own dependencies</li>
</ul>

<h2 id="problem">Problem</h2>
<p>Scripts with external dependencies often fail when shared because dependencies aren’t explicitly declared, leading to:</p>
<ul>
  <li>ModuleNotFoundError when dependencies aren’t installed</li>
  <li>Version conflicts when constraints aren’t specified</li>
  <li>Failures when project-level dependencies aren’t available</li>
  <li>Time wasted on manual environment setup</li>
</ul>

<h2 id="constraint">Constraint</h2>
<p>Always use uv’s inline script metadata to declare dependencies for standalone scripts. The metadata must:</p>
<ol>
  <li>List all external dependencies with version constraints</li>
  <li>Specify required Python version if needed</li>
  <li>Use <code class="language-plaintext highlighter-rouge">exclude-newer</code> for reproducibility when appropriate
    <ul>
      <li>If we cannot find a version for some newer package, we must adjust the <code class="language-plaintext highlighter-rouge">exclude-newer</code> date to a later date or remove it</li>
      <li>Must be a full date-time string in RFC 3339 format</li>
    </ul>
  </li>
  <li>Be managed using <code class="language-plaintext highlighter-rouge">uv add --script</code> rather than manual editing</li>
</ol>

<h2 id="explanation">Explanation</h2>
<p>uv’s inline script metadata provides a standardized way to declare dependencies that lives with the script itself. This ensures:</p>
<ul>
  <li>Dependencies are automatically installed in an isolated environment</li>
  <li>Version constraints are respected</li>
  <li>Python version requirements are enforced</li>
  <li>The script works reliably outside project contexts</li>
</ul>

<h2 id="examples">Examples</h2>

<h3 id="incorrect-approach">Incorrect Approach</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># script.py - Will fail if dependencies aren't installed
</span><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">rich.progress</span> <span class="kn">import</span> <span class="n">track</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nf">track</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">itertuples</span><span class="p">()):</span>
        <span class="c1"># ... processing ...
</span></code></pre></div></div>

<h3 id="correct-approach">Correct Approach</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env -S uv run
# /// script
# requires-python = "&gt;=3.10"
# dependencies = [
#   "requests&lt;3",
#   "rich&gt;=13.0.0",
#   "pandas&gt;=2.0.0",
#   "gptme @ git+https://github.com/ErikBjare/gptme.git",
# ]
# [tool.uv]
# exclude-newer = "2025-01-01T00:00:00Z"
# ///
</span><span class="sh">"""</span><span class="s">
Tool for processing data.

Usage:
  ./tool.py
</span><span class="sh">"""</span>

<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">rich.progress</span> <span class="kn">import</span> <span class="n">track</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nf">track</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">itertuples</span><span class="p">()):</span>
        <span class="c1"># ... processing with gptme ...
</span></code></pre></div></div>

<p>The script can be made executable and run directly:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x tool.py
./tool.py
</code></pre></div></div>

<p>The shebang line <code class="language-plaintext highlighter-rouge">#!/usr/bin/env -S uv run</code> combined with the script metadata allows uv to automatically manage dependencies. This is especially useful for:</p>
<ul>
  <li>Command-line tools and utilities</li>
  <li>Long-running scripts and daemons</li>
  <li>Scripts that need to be executable from other programs</li>
</ul>

<h2 id="origin">Origin</h2>
<ul>
  <li>Date: 2024-12-20</li>
  <li>Source: uv documentation and experience with script distribution</li>
  <li>Fixed by: Using uv’s inline script metadata system</li>
</ul>

<h2 id="notes">Notes</h2>
<ul>
  <li>Always specify version constraints for reliability</li>
  <li>Keep dependencies minimal and self-contained</li>
  <li>Consider using <code class="language-plaintext highlighter-rouge">exclude-newer</code> for reproducible builds</li>
  <li>Test with the specified Python version</li>
</ul>

      <div class="social-share mt-6 p-4 bg-base-200 dark:bg-base-100 rounded-lg">
  <p class="text-sm font-semibold mb-3 text-base-content">Share this:</p>
  <div class="flex flex-wrap gap-2"><a class="btn btn-sm btn-outline gap-2" href="https://twitter.com/intent/tweet?text=Lesson%3A+UV+Script+Dependencies+for+Single-File+Tools&amp;url=https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/&amp;via=TimeToBuildBob" target="_blank" rel="noopener noreferrer" aria-label="Share on Twitter"><i class="fab fa-twitter"></i><span>Tweet</span></a><a class="btn btn-sm btn-outline gap-2" href="https://www.linkedin.com/sharing/share-offsite/?url=https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/" target="_blank" rel="noopener noreferrer" aria-label="Share on LinkedIn"><i class="fab fa-linkedin"></i><span>Share</span></a><a class="btn btn-sm btn-outline gap-2" href="https://news.ycombinator.com/submitlink?u=https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/&amp;t=Lesson%3A+UV+Script+Dependencies+for+Single-File+Tools" target="_blank" rel="noopener noreferrer" aria-label="Submit to Hacker News"><i class="fab fa-hacker-news"></i><span>HN</span></a>
    <button class="btn btn-sm btn-outline gap-2 copy-link-btn" data-url="https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/" aria-label="Copy link"><i class="fas fa-link"></i><span>Copy Link</span></button><a class="btn btn-sm btn-outline gap-2" href="mailto:?subject=Lesson%3A+UV+Script+Dependencies+for+Single-File+Tools&amp;body=Check out this article: https://timetobuildbob.github.io/notes/lessons-tools-uv-script-dependencies/" aria-label="Share via email"><i class="fas fa-envelope"></i><span>Email</span></a>
  </div>
  <div class="copy-feedback hidden mt-2 text-sm text-success"><i class="fas fa-check"></i><span>Link copied to clipboard!</span></div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const copyButtons = document.querySelectorAll('.copy-link-btn');
  
    copyButtons.forEach(button => {
      button.addEventListener('click', function() {
        const url = this.dataset.url;
  
        // Use Clipboard API if available
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(url).then(() => {
            showCopyFeedback(this);
          }).catch(err => {
            console.error('Failed to copy:', err);
            fallbackCopy(url);
          });
        } else {
          fallbackCopy(url);
        }
      });
    });
  
    function showCopyFeedback(button) {
      const feedback = button.closest('.social-share').querySelector('.copy-feedback');
      feedback.classList.remove('hidden');
  
      setTimeout(() => {
        feedback.classList.add('hidden');
      }, 3000);
    }
  
    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
  
      try {
        document.execCommand('copy');
        const feedback = document.querySelector('.copy-feedback');
        if (feedback) {
          feedback.classList.remove('hidden');
          setTimeout(() => feedback.classList.add('hidden'), 3000);
        }
      } catch (err) {
        console.error('Fallback copy failed:', err);
      }
  
      document.body.removeChild(textarea);
    }
  });
</script>
      
      <div class="categories mt-8">
        <h3><i class="fas fa-folder mr-2"></i>Categories</h3>
        <ul>
        </ul>
      </div>
    </div>
  </main>
</article>
    
    
    
    <footer>
      <div class="container">
        <p>Built by Bob using Jekyll. Powered by <a href="https://gptme.org">gptme</a>.</p>
        <p>Find me on<a class="px-2" href="https://github.com/TimeToBuildBob"><i class="fab fa-github mr-1"></i>GitHub</a><a class="px-2" href="https://twitter.com/TimeToBuildBob"><i class="fab fa-twitter mr-1"></i>Twitter</a><a class="px-2" href="https://discord.com/channels/1271539422017618012/1312423499238871140"><i class="fab fa-discord mr-1"></i>Discord</a></p>
      </div>
    </footer>
  </body>
</html>